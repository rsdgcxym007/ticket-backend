# 🎫 Flow การทำงานของระบบ Ticket Backend

> **วันที่:** 11 สิงหาคม 2025  
> **โปรเจค:** Boxing Ticket Booking System  
> **สถานะ:** Production Flow Documentation

---

## 🏗️ **สถาปัตยกรรมการทำงาน (System Flow Architecture)**

### **🌐 Frontend Structure**
```
📱 Web Application
├── 🏠 หน้าหลัก (Index)
├── 🎟️ ซื้อตั๋วนั่ง (Seated Ticket)
├── 🧍 ซื้อตั๋วยืน (Standing Ticket)  
├── 📞 ติดต่อเรา (Contact)
└── 🔐 หน้าแอดมิน (Admin Panel)
    ├── 📊 Dashboard
    ├── 📋 รายการออเดอร์
    ├── 👥 จัดการผู้แนะนำ
    └── 👔 จัดการพนักงาน
```

---

## 👤 **User Roles & Permissions**

### **🎯 Roles ที่ใช้งานจริง**
1. **👑 ADMIN** - ผู้ดูแลระบบระดับสูง
2. **👔 STAFF** - พนักงานปฏิบัติการ
3. **👤 USER** - ลูกค้าทั่วไป (สำหรับ Login ซื้อตั๋ว)

### **🔐 สิทธิ์การเข้าถึง**

#### **👑 ADMIN (เข้าถึงได้ทุกอย่าง)**
- ✅ Dashboard - ดูข้อมูลทุกอย่าง
- ✅ รายการออเดอร์ - จัดการ/แก้ไข/ยกเลิก ได้ทั้งหมด
- ✅ จัดการผู้แนะนำ - เพิ่ม/แก้ไข/ลบ ได้
- ✅ จัดการพนักงาน - เพิ่ม/แก้ไข/ลบ/รีเซ็ตรหัสผ่าน ได้
- ✅ Analytics & Reports - ดูรายงานทุกประเภท
- ✅ System Config - ตั้งค่าระบบ
- ✅ ซื้อตั๣ว - สามารถซื้อตั๋วแทนลูกค้าได้

#### **👔 STAFF (สิทธิ์ปฏิบัติการ)**
- ✅ Dashboard - ดูข้อมูลพื้นฐาน
- ✅ รายการออเดอร์ - ดู/แก้ไข/ยืนยันการชำระเงิน
- ✅ จัดการผู้แนะนำ - ดู/แก้ไข (ไม่สามารถลบได้)
- ❌ จัดการพนักงาน - ดูได้เฉพาะข้อมูลตัวเอง
- ✅ Analytics - ดูรายงานพื้นฐาน
- ✅ ซื้อตั๋ว - สามารถซื้อตั๋วแทนลูกค้าได้

#### **👤 USER (ลูกค้า)**
- ✅ ซื้อตั๋ว - สามารถซื้อตั๋วได้เมื่อ Login
- ✅ ดูประวัติออเดอร์ของตัวเอง
- ✅ ยกเลิกออเดอร์ของตัวเอง (ถ้าอยู่ในเงื่อนไข)
- ❌ เข้าถึงหน้า Admin ไม่ได้

---

## 🔄 **Main User Flows**

### **🏠 1. หน้าหลัก (Index Page)**
```
👤 ผู้เยี่ยมชม
    ↓
🏠 เข้าหน้าหลัก
    ↓
📋 ดูข้อมูลการแข่งขัน
    ↓
🎯 เลือกกิจกรรม
    ├── 🎟️ ซื้อตั๋วนั่ง
    ├── 🧍 ซื้อตั๋วยืน
    ├── 📞 ติดต่อเรา
    └── 🔐 Login (สำหรับ Admin/Staff)
```

---

### **🎟️ 2. Flow การซื้อตั๋วนั่ง (Seated Ticket)**

#### **📝 ขั้นตอนการซื้อ**
```
1️⃣ เลือกโซนที่นั่ง
    ↓
2️⃣ เลือกที่นั่งเฉพาะ
    ↓
3️⃣ ระบบล็อกที่นั่งชั่วคราว (5-10 นาที)
    ↓
4️⃣ กรอกข้อมูลลูกค้า
    ├── ชื่อ-นามสกุล
    ├── เบอร์โทร
    ├── อีเมล
    └── รหัสผู้แนะนำ (ถ้ามี)
    ↓
5️⃣ เลือกช่องทางชำระเงิน
    ├── 💵 เงินสด (สำหรับ Staff/Admin)
    ├── 📱 QR PromptPay
    └── 🏦 โอนเงินธนาคาร
    ↓
6️⃣ ยืนยันออเดอร์
    ↓
7️⃣ ชำระเงิน/อัปโหลดสลิป
    ↓
8️⃣ รออนุมัติ (สำหรับโอนเงิน)
    ↓
9️⃣ ได้รับตั๋ว PDF + QR Code
```

#### **🔒 การล็อกที่นั่ง**
```
👤 ลูกค้าเลือกที่นั่ง
    ↓
🔒 ระบบล็อกที่นั่งทันที
    ↓
⏰ ตั้งเวลาหมดอายุ (5-10 นาที)
    ↓
    ├── ✅ ชำระเงินภายในเวลา → ยืนยันการจอง
    └── ❌ ไม่ชำระเงิน → ปลดล็อกอัตโนมัติ
```

---

### **🧍 3. Flow การซื้อตั๋วยืน (Standing Ticket)**

#### **📝 ขั้นตอนการซื้อ**
```
1️⃣ เลือกประเภทตั๋ว
    ├── 👨 ผู้ใหญ่ (จำนวน)
    └── 👶 เด็ก (จำนวน)
    ↓
2️⃣ กรอกข้อมูลลูกค้า
    ↓
3️⃣ เลือกช่องทางชำระเงิน
    ↓
4️⃣ ยืนยันออเดอร์
    ↓
5️⃣ ชำระเงิน
    ↓
6️⃣ ได้รับตั๋ว PDF + QR Code
```

---

### **🔐 4. Flow การ Login**

#### **🎯 สำหรับ Admin/Staff**
```
🔐 หน้า Login
    ↓
📧 กรอก Email + Password
    ↓
✅ ตรวจสอบสิทธิ์
    ↓
    ├── 👑 ADMIN → หน้า Admin Panel (เต็มสิทธิ์)
    ├── 👔 STAFF → หน้า Admin Panel (สิทธิ์จำกัด)
    └── 👤 USER → หน้าซื้อตั๋ว
```

#### **🎯 สำหรับลูกค้า**
```
🔐 Login เพื่อซื้อตั๋ว
    ↓
📱 เลือกช่องทาง
    ├── 📧 Email/Password
    ├── 🟦 Facebook
    ├── 🔴 Google
    └── 🟢 LINE
    ↓
✅ Login สำเร็จ
    ↓
🎟️ สามารถซื้อตั๋วได้
```

---

## 🏢 **Admin Panel Flows**

### **📊 1. Dashboard Flow**
```
👑 ADMIN / 👔 STAFF Login
    ↓
📊 Dashboard หลัก
    ├── 💰 ยอดขายวันนี้
    ├── 🎟️ จำนวนตั๋วที่ขายได้
    ├── 👥 จำนวนลูกค้า
    ├── 💺 สถานะที่นั่ง
    ├── 📈 กราฟยอดขาย
    └── ⚡ สถานะระบบ
```

### **📋 2. รายการออเดอร์ Flow**
```
📋 รายการออเดอร์
    ↓
🔍 ฟิลเตอร์/ค้นหา
    ├── 📅 วันที่
    ├── 📊 สถานะ
    ├── 💳 ช่องทางชำระเงิน
    └── 👤 ลูกค้า
    ↓
📝 จัดการออเดอร์
    ├── 👁️ ดูรายละเอียด
    ├── ✏️ แก้ไขข้อมูล
    ├── ✅ ยืนยันการชำระเงิน
    ├── 🔄 เปลี่ยนที่นั่ง
    ├── ❌ ยกเลิกออเดอร์
    └── 🎟️ ออกตั๋ว PDF
```

#### **🔄 การเปลี่ยนที่นั่ง**
```
📋 เลือกออเดอร์
    ↓
🔄 เปลี่ยนที่นั่ง
    ↓
🎯 เลือกที่นั่งใหม่
    ↓
💰 ตรวจสอบราคา
    ├── 💸 ถ้าราคาลด → คืนเงินส่วนต่าง
    ├── 💰 ถ้าราคาเพิ่ม → เรียกเก็บเพิ่ม
    └── 💯 ราคาเท่าเดิม → ไม่เปลี่ยนแปลง
    ↓
✅ ยืนยันการเปลี่ยน
    ↓
📝 บันทึก Audit Log
```

### **👥 3. จัดการผู้แนะนำ Flow**
```
👥 จัดการผู้แนะนำ
    ↓
📋 รายการผู้แนะนำ
    ├── ➕ เพิ่มผู้แนะนำใหม่
    ├── ✏️ แก้ไขข้อมูล
    ├── 📊 ดูยอดขาย
    ├── 💰 คำนวณค่าคอมมิชชั่น
    └── 📄 ออกรายงาน PDF
    ↓
📈 รายงานผู้แนะนำ
    ├── 📊 ยอดขายรายเดือน
    ├── 💰 ค่าคอมมิชชั่น
    ├── 🎟️ จำนวนตั๋วที่ขาย
    └── 🖨️ พิมพ์ใบเสร็จ Thermal
```

### **👔 4. จัดการพนักงาน Flow**
```
👔 จัดการพนักงาน
    ↓
📋 รายการพนักงาน
    ├── ➕ เพิ่มพนักงานใหม่
    ├── ✏️ แก้ไขข้อมูล
    ├── 🔑 รีเซ็ตรหัสผ่าน
    ├── 🔗 เชื่อมต่อกับ User Account
    └── 🗑️ ลบพนักงาน (ADMIN เท่านั้น)
    ↓
⚙️ ตั้งค่าสิทธิ์
    ├── 📊 สิทธิ์ Dashboard
    ├── 📋 สิทธิ์จัดการออเดอร์
    ├── 👥 สิทธิ์จัดการผู้แนะนำ
    └── 📈 สิทธิ์ดู Analytics
```

---

## 🔄 **Payment Flow (การชำระเงิน)**

### **💳 ช่องทางการชำระเงิน**

#### **1. 💵 เงินสด (Cash)**
```
👔 Staff/Admin เลือกเงินสด
    ↓
💰 รับเงินจากลูกค้า
    ↓
✅ ยืนยันการรับเงิน
    ↓
🎟️ ออกตั๋วทันที
```

#### **2. 📱 QR PromptPay**
```
📱 เลือก QR PromptPay
    ↓
🔢 ระบบสร้าง QR Code
    ↓
📷 ลูกค้าสแกน QR
    ↓
💰 โอนเงินผ่าน Banking App
    ↓
📸 อัปโหลดสลิปการโอน
    ↓
👔 Staff ตรวจสอบและยืนยัน
    ↓
🎟️ ออกตั๋ว
```

#### **3. 🏦 โอนเงินธนาคาร**
```
🏦 เลือกโอนเงินธนาคาร
    ↓
📋 แสดงเลขบัญชีปลายทาง
    ↓
💰 ลูกค้าโอนเงิน
    ↓
📸 อัปโหลดสลิปการโอน
    ↓
👔 Staff ตรวจสอบ
    ├── ✅ ยืนยัน → ออกตั๋ว
    └── ❌ ปฏิเสธ → แจ้งเหตุผล
```

---

## 📊 **Data Flow & Status Management**

### **🎟️ Order Status Flow**
```
💭 PENDING (รอชำระเงิน)
    ↓
💰 PAID (ชำระเงินแล้ว)
    ↓
✅ CONFIRMED (ยืนยันแล้ว)
    ↓
🎫 COMPLETED (ใช้งานแล้ว)

🔄 สามารถ:
    ├── ❌ CANCELLED (ยกเลิก)
    └── 💸 REFUNDED (คืนเงิน)
```

### **💺 Seat Status Flow**
```
🟢 AVAILABLE (พร้อมจอง)
    ↓
🔒 LOCKED (ล็อกชั่วคราว)
    ↓
    ├── ✅ ชำระเงิน → 🔴 BOOKED
    └── ⏰ หมดเวลา → 🟢 AVAILABLE
```

### **💳 Payment Status Flow**
```
💭 PENDING (รอชำระ)
    ↓
💰 PAID (ชำระแล้ว)
    ↓
    ├── ✅ VERIFIED (ยืนยันแล้ว)
    ├── ❌ FAILED (ล้มเหลว)
    └── 💸 REFUNDED (คืนเงิน)
```

---

## 🔔 **Notification Flow**

### **📧 การแจ้งเตือนลูกค้า**
```
🎟️ มีการสร้างออเดอร์
    ↓
📧 ส่งอีเมลยืนยัน
    ↓
💰 ชำระเงินสำเร็จ
    ↓
📧 ส่งตั๋ว PDF
    ↓
📱 SMS แจ้งเตือน (ถ้ามีเบอร์)
```

### **🔔 การแจ้งเตือน Staff**
```
💰 มีการชำระเงินใหม่
    ↓
🔔 แจ้งเตือน Staff
    ↓
👔 Staff ตรวจสอบ
    ↓
✅ ยืนยันการชำระเงิน
    ↓
📧 แจ้งลูกค้า
```

---

## 📈 **Analytics & Reporting Flow**

### **📊 รายงานที่สร้างได้**
```
📈 Analytics Dashboard
    ├── 💰 รายงานรายได้
    │   ├── รายวัน/รายเดือน/รายปี
    │   ├── แยกตามช่องทางชำระเงิน
    │   └── แยกตามประเภทตั๋ว
    ├── 🎟️ รายงานการขาย
    │   ├── จำนวนตั๋วที่ขาย
    │   ├── อัตราการยกเลิก
    │   └── ยอดขายตามที่นั่ง
    ├── 👥 รายงานลูกค้า
    │   ├── ลูกค้าใหม่/เก่า
    │   ├── พฤติกรรมการซื้อ
    │   └── ช่องทางการเข้าถึง
    └── 👔 รายงานพนักงาน
        ├── ประสิทธิภาพการขาย
        ├── เวลาการทำงาน
        └── การใช้งานระบบ
```

---

## 🔒 **Security Flow**

### **🛡️ การป้องกันความปลอดภัย**
```
🌐 HTTP Request
    ↓
🛡️ Rate Limiting (ป้องกัน Spam)
    ↓
🔐 JWT Authentication
    ↓
👤 Role-based Authorization
    ↓
✅ Input Validation
    ↓
💾 Audit Logging
    ↓
📊 API Response
```

### **📝 Audit Trail**
```
👤 ผู้ใช้ทำการกระทำ
    ↓
📝 บันทึก Audit Log
    ├── 👤 ผู้ทำการ
    ├── ⏰ เวลา
    ├── 🎯 การกระทำ
    ├── 📋 ข้อมูลเก่า/ใหม่
    └── 🌐 IP Address
    ↓
💾 เก็บในฐานข้อมูล
    ↓
📊 สร้างรายงาน
```

---

## 🚀 **Mobile App Integration**

### **📱 Mobile API Flow**
```
📱 Mobile App
    ↓
🔐 Login/Authentication
    ↓
🏠 หน้าหลัก
    ├── 🎟️ ดูตั๋วที่มี
    ├── 📋 ประวัติการซื้อ
    └── 👤 จัดการโปรไฟล์
    ↓
🎫 ซื้อตั๋วผ่าน Mobile
    ↓
💳 ชำระเงินผ่าน App
    ↓
📱 รับตั๋ว Digital
```

---

## ⚡ **Performance & Monitoring**

### **📊 System Monitoring**
```
⚡ System Health Check
    ├── 🗄️ Database Connection
    ├── 💾 Memory Usage
    ├── 🔄 API Response Time
    └── 📈 Concurrent Users
    ↓
🚨 Alert System
    ├── 📧 Email Alerts
    ├── 📱 SMS Alerts
    └── 🔔 Dashboard Notifications
```

---

## 🎯 **สรุป Flow การทำงานหลัก**

### **🏆 จุดแข็งของ Flow ปัจจุบัน**
1. **🔒 ปลอดภัย** - มีการล็อกที่นั่ง, Authentication ครบถ้วน
2. **⚡ เร็ว** - การจองและชำระเงินรวดเร็ว
3. **🔄 ยืดหยุ่น** - รองรับหลายช่องทางการชำระเงิน
4. **📊 ครบครัน** - มีรายงานและการติดตาม
5. **👥 ใช้งานง่าย** - Interface เข้าใจง่ายสำหรับทุก Role

### **🎯 Flow หลักที่สำคัญ**
1. **ลูกค้าซื้อตั๋ว** → เลือกที่นั่ง → ชำระเงิน → ได้ตั๋ว
2. **Staff จัดการ** → ตรวจสอบการชำระเงิน → ยืนยัน → ออกตั๋ว
3. **Admin ควบคุม** → ดูรายงาน → จัดการข้อมูล → ตั้งค่าระบบ

ระบบถูกออกแบบให้ทำงานได้อย่างมีประสิทธิภาพและปลอดภัยสำหรับการจองตั๋วชกมวยแบบครบวงจร! 🥊🎫
