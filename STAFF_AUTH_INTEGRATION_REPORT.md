# ğŸ“‹ à¸ªà¸£à¸¸à¸›à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Staff à¸à¸±à¸š Auth à¹à¸¥à¸° User System

## ğŸ” à¸ªà¸–à¸²à¸™à¸°à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™

### âœ… **à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§:**

#### 1. **à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡ Staff à¹ƒà¸«à¸¡à¹ˆ (Integrated)**
à¹€à¸¡à¸·à¹ˆà¸­à¹à¸­à¸”à¸¡à¸´à¸™à¸ªà¸£à¹‰à¸²à¸‡ Staff à¹ƒà¸«à¸¡à¹ˆ à¸£à¸°à¸šà¸šà¸ˆà¸°à¸ªà¸£à¹‰à¸²à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” 3 records:

```typescript
// 1. User Record
const user = {
  email: 'staff@example.com',
  name: 'à¸Šà¸·à¹ˆà¸­ à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥',
  role: 'staff'
}

// 2. Staff Record (à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸à¸±à¸š User)
const staff = {
  staffCode: 'STF2507001', // auto-generated
  firstName: 'à¸Šà¸·à¹ˆà¸­',
  lastName: 'à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥',
  email: 'staff@example.com',
  userId: user.id, // â† à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸à¸±à¸š User
  permissions: [...defaultPermissions],
  // ... à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸·à¹ˆà¸™à¹†
}

// 3. Auth Record (à¸ªà¸³à¸«à¸£à¸±à¸š Login)
const auth = {
  email: 'staff@example.com',
  password: hashedPassword, // Staff{staffCode}!
  providerId: user.id,
  userId: user.id,
  role: 'staff',
  provider: 'manual'
}
```

#### 2. **à¸à¸²à¸£ Login à¸‚à¸­à¸‡ Staff**
- Staff à¸ªà¸²à¸¡à¸²à¸£à¸– login à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µà¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸–à¸¹à¸à¸ªà¸£à¹‰à¸²à¸‡
- à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™: `Staff{staffCode}!` (à¹€à¸Šà¹ˆà¸™ `StaffSTF2507001!`)
- Login à¸ˆà¸°à¹„à¸”à¹‰ JWT token à¸—à¸µà¹ˆà¸¡à¸µ:
  ```json
  {
    "sub": "user_id",
    "email": "staff@example.com", 
    "role": "staff",
    "staffId": "staff_uuid",
    "permissions": ["view_analytics", "manage_orders", ...]
  }
  ```

#### 3. **à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸´à¸—à¸˜à¸´à¹Œ**
- Auth system à¸ˆà¸°à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µ Staff record à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
- à¸–à¹‰à¸²à¸¡à¸µ à¸ˆà¸°à¸£à¸§à¸¡ staff info à¹ƒà¸™ JWT
- Staff à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰ permissions à¹ƒà¸™à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ endpoints à¸•à¹ˆà¸²à¸‡à¹†

### ğŸ”§ **Features à¸—à¸µà¹ˆà¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¹„à¸›:**

#### 1. **Reset Password**
```http
PATCH /staff/:id/reset-password
Authorization: Bearer {admin_token}
```
- Admin à¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸à¸™à¸±à¸à¸‡à¸²à¸™à¹„à¸”à¹‰
- à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹ƒà¸«à¸¡à¹ˆà¸ˆà¸°à¹€à¸›à¹‡à¸™ `Staff{staffCode}!`

#### 2. **Link Staff to Existing User**
```http
PATCH /staff/:id/link-user
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "userId": "existing_user_id"
}
```

#### 3. **Staff Permissions Check**
```http
GET /staff/my/permissions
Authorization: Bearer {staff_token}
```

## ğŸ”— **à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ Tables**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    User     â”‚    â”‚    Staff    â”‚    â”‚    Auth     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â—„â”€â”€â”€â”¤ userId (FK) â”‚    â”‚ userId (FK) â”‚â”€â”€â”€â”€â”
â”‚ email       â”‚    â”‚ id (PK)     â”‚    â”‚ email       â”‚    â”‚
â”‚ name        â”‚    â”‚ staffCode   â”‚    â”‚ password    â”‚    â”‚
â”‚ role        â”‚    â”‚ firstName   â”‚    â”‚ providerId  â”‚    â”‚
â”‚ ...         â”‚    â”‚ lastName    â”‚    â”‚ role        â”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ email       â”‚    â”‚ ...         â”‚    â”‚
                   â”‚ permissions â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                   â”‚ ...         â”‚                       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
                                                         â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
              providerId = User.id
```

## ğŸš€ **à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™**

### 1. **à¸ªà¸£à¹‰à¸²à¸‡ Staff à¹ƒà¸«à¸¡à¹ˆ**
```bash
curl -X POST http://localhost:3000/staff \
  -H "Authorization: Bearer {admin_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "à¸ªà¸¡à¸Šà¸²à¸¢",
    "lastName": "à¹ƒà¸ˆà¸”à¸µ", 
    "email": "somchai@example.com",
    "role": "staff",
    "department": "à¸à¸²à¸£à¸‚à¸²à¸¢"
  }'
```

**Response:**
```json
{
  "success": true,
  "message": "à¸ªà¸£à¹‰à¸²à¸‡à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¹‰à¸­à¸¡à¸šà¸±à¸à¸Šà¸µà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹à¸¥à¸°à¸ªà¸´à¸—à¸˜à¸´à¹Œà¹ƒà¸™à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š",
  "data": {
    "id": "uuid",
    "staffCode": "STF2507001",
    "firstName": "à¸ªà¸¡à¸Šà¸²à¸¢",
    "lastName": "à¹ƒà¸ˆà¸”à¸µ",
    "email": "somchai@example.com",
    // ...
  },
  "note": "à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™: StaffSTF2507001!"
}
```

### 2. **Staff Login**
```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "somchai@example.com",
    "password": "StaffSTF2507001!"
  }'
```

**Response:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "auth_id",
    "email": "somchai@example.com",
    "role": "staff",
    // ...
  },
  "staff": {
    "id": "staff_id",
    "staffCode": "STF2507001",
    "fullName": "à¸ªà¸¡à¸Šà¸²à¸¢ à¹ƒà¸ˆà¸”à¸µ",
    "role": "staff",
    "permissions": ["view_analytics", "manage_orders"],
    // ...
  }
}
```

## ğŸ“ **à¸ªà¸£à¸¸à¸›**

### âœ… **à¸•à¸­à¸šà¸„à¸³à¸–à¸²à¸¡: "à¸¡à¸±à¸™à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸à¸±à¸š auth à¹à¸¥à¸° user à¹à¸¥à¹‰à¸§à¸«à¸£à¸·à¸­à¸¢à¸±à¸‡?"**

**âœ… à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¹à¸¥à¹‰à¸§!** 

1. **Staff â†” User**: à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸œà¹ˆà¸²à¸™ `userId` field
2. **Staff â†” Auth**: à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸œà¹ˆà¸²à¸™ `email` à¹à¸¥à¸°à¸¡à¸µ Auth record à¸ªà¸³à¸«à¸£à¸±à¸š login
3. **Auth â†” User**: à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸œà¹ˆà¸²à¸™ `providerId` à¹à¸¥à¸° `userId`

### âœ… **à¸•à¸­à¸šà¸„à¸³à¸–à¸²à¸¡: "à¸–à¹‰à¸²à¹à¸­à¸”à¸¡à¸´à¸™à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸«à¹‰à¹à¸¥à¹‰à¸§ à¸¡à¸±à¸™à¸•à¹‰à¸­à¸‡ login à¹„à¸”à¹‰"**

**âœ… Login à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ!**

- à¹à¸­à¸”à¸¡à¸´à¸™à¸ªà¸£à¹‰à¸²à¸‡ Staff â†’ à¸£à¸°à¸šà¸šà¸ªà¸£à¹‰à¸²à¸‡ User + Auth à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
- Staff à¹„à¸”à¹‰à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™: `Staff{staffCode}!`
- Staff à¸ªà¸²à¸¡à¸²à¸£à¸– login à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µà¸”à¹‰à¸§à¸¢à¸­à¸µà¹€à¸¡à¸¥à¹à¸¥à¸°à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸™à¸µà¹‰
- Login à¹à¸¥à¹‰à¸§à¹„à¸”à¹‰ JWT à¸—à¸µà¹ˆà¸¡à¸µ staff permissions à¸„à¸£à¸šà¸–à¹‰à¸§à¸™

### ğŸ”§ **à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š**

à¸£à¸±à¸™à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸™à¸µà¹‰à¹€à¸à¸·à¹ˆà¸­à¸—à¸”à¸ªà¸­à¸šà¸—à¸±à¹‰à¸‡à¸£à¸°à¸šà¸š:
```bash
./test-staff-auth.sh
```

à¸£à¸°à¸šà¸šà¸ˆà¸°à¸—à¸”à¸ªà¸­à¸š:
1. Admin login
2. à¸ªà¸£à¹‰à¸²à¸‡ Staff à¹ƒà¸«à¸¡à¹ˆ
3. Staff login à¸”à¹‰à¸§à¸¢à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™
4. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š permissions
5. Reset password
6. Login à¸”à¹‰à¸§à¸¢à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹ƒà¸«à¸¡à¹ˆ

## ğŸ‰ **à¸ªà¸£à¸¸à¸›à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢**

à¸£à¸°à¸šà¸š Staff Management à¹„à¸”à¹‰à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š Auth à¹à¸¥à¸° User system à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œà¹à¸¥à¹‰à¸§! 

à¹€à¸¡à¸·à¹ˆà¸­à¹à¸­à¸”à¸¡à¸´à¸™à¸ªà¸£à¹‰à¸²à¸‡ Staff à¹ƒà¸«à¸¡à¹ˆ:
- âœ… à¸ªà¸£à¹‰à¸²à¸‡ User record
- âœ… à¸ªà¸£à¹‰à¸²à¸‡ Staff record à¸à¸£à¹‰à¸­à¸¡ permissions
- âœ… à¸ªà¸£à¹‰à¸²à¸‡ Auth record à¸ªà¸³à¸«à¸£à¸±à¸š login
- âœ… Staff à¸ªà¸²à¸¡à¸²à¸£à¸– login à¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ
- âœ… à¸¡à¸µ JWT token à¸à¸£à¹‰à¸­à¸¡ staff permissions
- âœ… à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ API endpoints à¹„à¸”à¹‰à¸•à¸²à¸¡ role
